<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Ajouter ou Modifier un projet – Agence Immo</title>
  <style>
    :root{--bg:#f7f7f8;--card:#fff;--ink:#1a1a1f;--muted:#6b7280;--accent:#0f3d6e;--accent-2:#1e68b3;--line:#e5e7eb;--shadow:0 6px 18px rgba(2,6,23,.08);--radius:14px;}
    body{margin:0;font-family:system-ui,Roboto,Inter,sans-serif;background:var(--bg);color:var(--ink);}
    .container{width:min(1100px,92vw);margin-inline:auto;}
    header{position:sticky;top:0;background:rgba(255,255,255,.9);backdrop-filter:blur(10px);border-bottom:1px solid var(--line);}
    nav{display:flex;align-items:center;justify-content:space-between;padding:14px 0;}
    .brand{display:flex;align-items:center;gap:10px;text-decoration:none;color:var(--ink)}
    .logo{width:38px;height:38px;border-radius:10px;background:linear-gradient(135deg,var(--accent),var(--accent-2));box-shadow:var(--shadow)}
    .menu{display:flex;gap:16px}
    .menu a{text-decoration:none;color:var(--ink);padding:8px 12px;border-radius:8px}
    .menu a:hover{background:#edf2f7}
    .page-head{text-align:center;padding:26px 0 20px;}
    .page-head h2{margin:0;font-size:clamp(22px,2.5vw,32px);position:relative;display:inline-block;padding-bottom:8px;}
    .page-head h2::after{content:'';position:absolute;left:50%;transform:translateX(-50%);bottom:0;width:80px;height:3px;background:var(--accent);border-radius:2px;}
    form{background:#fff;padding:24px;border-radius:var(--radius);box-shadow:var(--shadow);display:grid;gap:18px;margin-bottom:40px;}
    label{font-weight:600;margin-bottom:6px;display:block;}
    input,textarea,select{width:100%;padding:12px 14px;border:1px solid var(--line);border-radius:10px;font-size:14px;}
    textarea{resize:vertical;min-height:100px;}
    .btn{padding:12px 22px;border:none;border-radius:10px;cursor:pointer;font-weight:600;margin-right:10px;}
    .btn-save{background:var(--accent);color:#fff;}
    .btn-save:hover{background:var(--accent-2);}
    .btn-validate{background:green;color:#fff;}
    .btn-validate:hover{background:darkgreen;}
    .btn-delete{background:crimson;color:#fff;}
    .btn-delete:hover{background:darkred;}
    .preview{margin-top:30px;}
    .card{background:var(--card);border:1px solid var(--line);border-radius:var(--radius);overflow:hidden;box-shadow:var(--shadow);}
    .media{position:relative;aspect-ratio:16/9;background:#eaeef3;}
    .media img{width:100%;height:100%;object-fit:cover;}
    .content{padding:20px;}
    .title{font-size:22px;margin:0;}
    .price{color:var(--accent);font-weight:600;font-size:18px;}
    .meta{color:var(--muted);font-size:14px;margin-bottom:10px;}
    .desc{margin-top:10px;line-height:1.6;}
    iframe{border:0;width:100%;height:300px;border-radius:var(--radius);margin-top:20px;}
  </style>
</head>
<body>
<header>
  <div class="container">
    <nav>
      <a href="index.html" class="brand"><div class="logo"></div><span>Agence Immo</span></a>
      <div class="menu">
        <a href="index.html">Accueil</a>
        <a href="catalogue.html">Catalogue</a>
        <a href="contact.html">Contact</a>
      </div>
    </nav>
  </div>
</header>

<main class="container">
  <section class="page-head"><h2>Ajouter ou Modifier un projet</h2></section>

  <form id="formProjet">
    <div><label>Titre</label><input type="text" id="titre" placeholder="Maison A – 120 m²"></div>
    <div><label>Prix (€)</label><input type="number" id="prix" placeholder="329000"></div>
    <div><label>Surface du bien (m²)</label><input type="number" id="surfaceBien" placeholder="120"></div>
    <div><label>Surface du terrain (m²)</label><input type="number" id="surfaceTerrain" placeholder="400"></div>
    <div><label>Ville</label><input type="text" id="ville" placeholder="Lyon"></div>
    <div><label>Adresse</label><input type="text" id="adresse" placeholder="12 rue de l'exemple"></div>
    <div><label>Département</label><input type="text" id="departement" placeholder="69"></div>
    <div><label>Type de projet</label>
      <select id="type">
        <option value="maison">Maison</option>
        <option value="terrain">Terrain</option>
      </select>
    </div>
    <div><label>Disponibilité</label>
      <select id="dispo">
        <option value="Disponible">Disponible</option>
        <option value="Indisponible">Indisponible</option>
        <option value="Bientôt disponible">Bientôt disponible</option>
      </select>
    </div>
    <div><label>Description</label><textarea id="desc" placeholder="Description complète du bien..."></textarea></div>
    <div><label>Images</label><input type="file" id="images" accept="image/*" multiple></div>
    <div>
      <button type="button" class="btn btn-save" id="saveBtn">Enregistrer</button>
      <button type="button" class="btn btn-validate" id="validateBtn">Valider</button>
      <button type="button" class="btn btn-delete" id="deleteBtn">Supprimer le projet</button>
    </div>
  </form>

  <section class="preview" id="preview" style="display:none">
    <article class="card">
      <div class="media"><img id="previewImg" src="" alt=""></div>
      <div class="content">
        <h3 class="title" id="previewTitle"></h3>
        <p class="price" id="previewPrice"></p>
        <p class="meta" id="previewMeta"></p>
        <p class="desc" id="previewDesc"></p>
        <iframe id="previewMap" loading="lazy"></iframe>
      </div>
    </article>
  </section>
</main>

<script>
function getFormData(){
  return {
    id: Date.now().toString(),
    titre: document.getElementById('titre').value,
    prix: document.getElementById('prix').value,
    surfaceBien: document.getElementById('surfaceBien').value,
    surfaceTerrain: document.getElementById('surfaceTerrain').value,
    ville: document.getElementById('ville').value,
    adresse: document.getElementById('adresse').value,
    departement: document.getElementById('departement').value,
    type: document.getElementById('type').value,
    dispo: document.getElementById('dispo').value,
    desc: document.getElementById('desc').value,
    images:[]
  };
}

function saveProject(data){
  let projets = JSON.parse(localStorage.getItem('projets')) || [];
  projets.push(data);
  localStorage.setItem('projets', JSON.stringify(projets));
}

function showPreview(projet){
  document.getElementById('preview').style.display = 'block';
  document.getElementById('previewTitle').textContent = projet.titre;
  document.getElementById('previewPrice').textContent = projet.prix ? projet.prix + ' €' : '';
  document.getElementById('previewMeta').textContent = `${projet.ville} (${projet.departement}) – ${projet.surfaceBien} m² hab. / ${projet.surfaceTerrain} m² terrain – ${projet.dispo}`;
  document.getElementById('previewDesc').textContent = projet.desc;
  if(projet.images && projet.images.length) document.getElementById('previewImg').src = projet.images[0];
  if(projet.ville || projet.adresse){
    const loc = encodeURIComponent(`${projet.adresse||''}, ${projet.ville||''}, ${projet.departement||''}`);
    document.getElementById('previewMap').src = 'https://www.openstreetmap.org/export/embed.html?search=' + loc;
  }
}

document.getElementById('saveBtn').addEventListener('click', ()=>{
  const data = getFormData();
  const files = document.getElementById('images').files;
  if(files.length){
    let loaded=0;
    Array.from(files).forEach(file=>{
      const reader = new FileReader();
      reader.onload = ()=>{
        data.images.push(reader.result);
        loaded++;
        if(loaded===files.length){ saveProject(data); showPreview(data); }
      };
      reader.readAsDataURL(file);
    });
  } else { saveProject(data); showPreview(data); }
});

document.getElementById('validateBtn').addEventListener('click', ()=>{
  document.getElementById('saveBtn').click();
  alert('Projet validé et sauvegardé !');
  window.location.href = 'catalogue.html';
});

document.getElementById('deleteBtn').addEventListener('click', ()=>{
  let projets = JSON.parse(localStorage.getItem('projets')) || [];
  projets.pop();
  localStorage.setItem('projets', JSON.stringify(projets));
  alert('Dernier projet supprimé !');
  document.getElementById('preview').style.display='none';
});
</script>
</body>
</html>
