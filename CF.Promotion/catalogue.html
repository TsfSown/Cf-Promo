<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Catalogue ‚Äì Agence Immo</title>
  <style>
    :root{
      --bg:#f7f7f8;--card:#ffffff;--ink:#1a1a1f;--muted:#6b7280;
      --accent:#0f3d6e;--accent-2:#1e68b3;--line:#e5e7eb;
      --shadow:0 6px 18px rgba(2,6,23,0.08);--radius:14px;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,Roboto,Inter,sans-serif;background:var(--bg);color:var(--ink);}
    .container{width:min(1200px,92vw);margin-inline:auto;}
    header{position:sticky;top:0;z-index:100;background:rgba(255,255,255,.9);backdrop-filter:blur(10px);border-bottom:1px solid var(--line);}
    nav{display:flex;align-items:center;justify-content:space-between;padding:14px 0;}
    .brand{display:flex;align-items:center;gap:10px;text-decoration:none;color:var(--ink)}
    .logo{width:38px;height:38px;border-radius:10px;background:linear-gradient(135deg,var(--accent),var(--accent-2));box-shadow:var(--shadow)}
    .menu{display:flex;gap:16px}
    .menu a{text-decoration:none;color:var(--ink);padding:8px 12px;border-radius:8px}
    .menu a:hover{background:#edf2f7}
    .page-head{text-align:center;padding:26px 0 20px;}
    .page-head h2{margin:0;font-size:clamp(22px,2.5vw,32px);position:relative;display:inline-block;padding-bottom:8px;}
    .page-head h2::after{content:'';position:absolute;left:50%;transform:translateX(-50%);bottom:0;width:80px;height:3px;background:var(--accent);border-radius:2px;}
    .page-head p{margin:6px 0 0;color:var(--muted)}
    .filters-box{background:#fff;border:1px solid var(--line);border-radius:var(--radius);box-shadow:var(--shadow);padding:20px;margin:20px 0;display:grid;gap:18px}
    .type-select{display:flex;gap:16px;justify-content:center}
    .type-btn{flex:1;display:flex;flex-direction:column;align-items:center;gap:6px;padding:14px;border:1px solid var(--line);border-radius:var(--radius);cursor:pointer;background:#fafafa;transition:.2s}
    .type-btn:hover{background:#f0f4f8}
    .type-btn.active{border-color:var(--accent);background:#eef6ff;color:var(--accent)}
    .type-btn span{font-size:14px;font-weight:500}
    .fields{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:14px;align-items:center}
    .fields input{width:100%;padding:12px 14px;border:1px solid var(--line);border-radius:10px;font-size:14px}
    .search-btn{grid-column:span 1;justify-self:end;padding:12px 22px;border:none;border-radius:10px;background:var(--accent);color:#fff;cursor:pointer;font-weight:600}
    .search-btn:hover{background:var(--accent-2)}
    
    .nav-btn{position:absolute;top:50%;transform:translateY(-50%);z-index:2;background:rgba(255,255,255,0.9);
      border:none;border-radius:50%;width:28px;height:28px;cursor:pointer;display:flex;align-items:center;justify-content:center;font-weight:bold;}
    .nav-btn.prev{left:6px;} .nav-btn.next{right:6px;}
.grid{display:grid;gap:18px;grid-template-columns:repeat(3,1fr);} 
    @media(max-width:900px){.grid{grid-template-columns:repeat(2,1fr);}}
    @media(max-width:600px){.grid{grid-template-columns:1fr;}}
    .card{background:var(--card);border:1px solid var(--line);border-radius:var(--radius);overflow:hidden;box-shadow:var(--shadow);display:flex;flex-direction:column}
    .media{position:relative;aspect-ratio:4/3;overflow:hidden;background:#eaeef3}
    .media img{width:100%;height:100%;object-fit:cover}
    .content{padding:14px;display:grid;gap:8px}
    .title{font-size:16px;margin:0}
    .meta{color:var(--muted);font-size:13px}
    .price{color:var(--accent);font-weight:600}
    footer{margin:40px 0 60px;text-align:center;color:var(--muted);font-size:14px}
    .btn-add{display:inline-block;margin-top:15px;padding:10px 18px;background:var(--accent);color:#fff;text-decoration:none;border-radius:10px;font-weight:600;box-shadow:var(--shadow);}
    .btn-add:hover{background:var(--accent-2);}
  </style>
</head>
<body>
<header>
  <div class="container">
    <nav>
      <a href="index.html" class="brand"><div class="logo"></div><span>Agence Immo</span></a>
      <div class="menu">
        <a href="index.html">Accueil</a>
        <a href="catalogue.html" class="active">Catalogue</a>
        <a href="contact.html">Contact</a>
      </div>
    </nav>
  </div>
</header>

<main class="container">
  <section class="page-head">
    <h2>Nos biens √† vendre</h2>
    <p>Parcourez nos biens et trouvez votre projet immobilier.</p>
    <a href="ajout-projet.html" class="btn-add">‚ûï Ajouter un projet</a>
  </section>

  <section class="filters-box">
    <div class="type-select">
      <button class="type-btn active" data-type="all"><span>üìã Tous les projets</span></button>
      <button class="type-btn" data-type="maison"><span>üè† Maison</span></button>
      <button class="type-btn" data-type="terrain"><span>üå± Terrain</span></button>
    </div>
    <div class="fields">
      <input type="text" id="dept" placeholder="D√©partement">
      <input type="text" id="ville" placeholder="Ville">
      <input type="number" id="budgetMin" placeholder="Budget min (‚Ç¨)">
      <input type="number" id="budgetMax" placeholder="Budget max (‚Ç¨)">
      <button class="search-btn" id="searchBtn">Rechercher</button>
    </div>
  </section>

  <section class="grid" id="projetsGrid"></section>

  <footer><p>¬© Agence Immo ‚Äî 2025 ¬∑ Tous droits r√©serv√©s.</p></footer>
</main>

<script>
let currentType = 'all';

document.querySelectorAll('.type-btn').forEach(btn=>{
  btn.addEventListener('click', ()=>{
    document.querySelectorAll('.type-btn').forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
    currentType = btn.dataset.type;
    filterProjects();
  });
});

document.getElementById('searchBtn').addEventListener('click', filterProjects);

function filterProjects(){
  const dept = (document.getElementById('dept').value || '').toLowerCase();
  const ville = (document.getElementById('ville').value || '').toLowerCase();
  const budgetMin = parseInt(document.getElementById('budgetMin').value) || 0;
  const budgetMax = parseInt(document.getElementById('budgetMax').value) || Infinity;

  const cards = document.querySelectorAll('#projetsGrid a');
  cards.forEach(link=>{
    const card = link.querySelector('.card');
    const type = card.dataset.type || 'maison';
    const pDept = (card.dataset.dept || '').toLowerCase();
    const pVille = (card.dataset.ville || '').toLowerCase();
    const prix = parseInt(card.dataset.prix || '0');
    let visible = true;
    if(currentType !== 'all' && type !== currentType) visible = false;
    if(dept && !pDept.includes(dept)) visible = false;
    if(ville && !pVille.includes(ville)) visible = false;
    if(prix < budgetMin || prix > budgetMax) visible = false;
    link.style.display = visible ? '' : 'none';
  });
}

document.addEventListener('DOMContentLoaded', ()=>{
  const grid = document.getElementById('projetsGrid');
  const saved = localStorage.getItem('projets');
  if(!saved) return;
  try{
    const projets = JSON.parse(saved);
    projets.forEach((p,index)=>{
      const a = document.createElement('a');
      a.href = 'page.html?id=' + encodeURIComponent(p.id);
      a.style.textDecoration='none';a.style.color='inherit';a.style.display='block';
      const card = document.createElement('article');
      card.className = 'card';
      card.dataset.type = p.type || 'maison';
      card.dataset.ville = p.ville || '';
      card.dataset.dept = p.departement || '';
      card.dataset.prix = p.prix || 0;
      const images = (p.images && p.images.length) ? p.images : [];
      let slidesHTML = '';
      images.forEach((src)=>{
        slidesHTML += `<div class="slide" style="flex:0 0 100%;"><img src="${src}" style="width:100%;height:100%;object-fit:cover;"></div>`;
      });
      card.innerHTML = `
        <div class="media" style="position:relative;overflow:hidden;">
          <div class="slides" id="slides-${index}" style="display:flex;transition:transform 0.5s;">${slidesHTML}</div>
        </div>
        <div class="content">
          <h3 class="title">${p.titre||''}</h3>
          <p class="price">${p.prix ? (Number(p.prix)).toLocaleString('fr-FR') + ' ‚Ç¨' : ''}</p>
          <p class="meta">${p.ville||''} (${p.departement||''}) ‚Äì ${p.surfaceBien||''} m¬≤ hab. / ${p.surfaceTerrain||''} m¬≤ terrain ‚Äì ${p.dispo||''}</p>
        </div>`;
      a.appendChild(card);
      grid.appendChild(a);
      if(images.length > 1){

      // boutons prev/next
      const mediaEl = card.querySelector('.media');
      const prevBtn = document.createElement('button');
      prevBtn.className='nav-btn prev'; prevBtn.textContent='‚óÄ';
      const nextBtn = document.createElement('button');
      nextBtn.className='nav-btn next'; nextBtn.textContent='‚ñ∂';
      mediaEl.appendChild(prevBtn); mediaEl.appendChild(nextBtn);
      prevBtn.addEventListener('click', (e)=>{ e.preventDefault(); e.stopPropagation();
        slideIndex = (slideIndex-1+images.length)%images.length;
        const slides = document.getElementById('slides-'+index);
        slides.style.transform='translateX(' + (-slideIndex*100) + '%)';
      });
      nextBtn.addEventListener('click', (e)=>{ e.preventDefault(); e.stopPropagation();
        slideIndex = (slideIndex+1)%images.length;
        const slides = document.getElementById('slides-'+index);
        slides.style.transform='translateX(' + (-slideIndex*100) + '%)';
      });

        let slideIndex = 0;
        setInterval(()=>{
          const slides = document.getElementById('slides-'+index);
          if(!slides) return;
          slideIndex = (slideIndex+1) % images.length;
          slides.style.transform = 'translateX(' + (-slideIndex*100) + '%)';
        }, 3000);
      }
    });
  }catch(e){ console.error('Erreur chargement projets', e); }
});
</script>
</body>
</html>
