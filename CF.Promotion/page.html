<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Fiche détaillée – Agence Immo</title>
  <style>
    :root{--bg:#f7f7f8;--card:#ffffff;--ink:#1a1a1f;--muted:#6b7280;--accent:#0f3d6e;--accent-2:#1e68b3;--line:#e5e7eb;--shadow:0 8px 24px rgba(2,6,23,0.08);--radius:14px;}
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,Roboto,Inter,sans-serif;background:var(--bg);color:var(--ink);line-height:1.55;}
    .container{width:min(1100px,92vw);margin-inline:auto;}
    header{position:sticky;top:0;z-index:10;background:rgba(255,255,255,.9);backdrop-filter:blur(10px);border-bottom:1px solid var(--line);}
    nav{display:flex;align-items:center;justify-content:space-between;padding:14px 0;}
    nav .brand{display:flex;align-items:center;gap:10px;text-decoration:none;color:var(--ink)}
    nav .logo{width:38px;height:38px;border-radius:10px;background:linear-gradient(135deg,var(--accent),var(--accent-2));box-shadow:var(--shadow)}
    nav .menu{display:flex;gap:16px}
    nav .menu a{text-decoration:none;color:var(--ink);padding:8px 12px;border-radius:8px}
    nav .menu a:hover{background:#edf2f7}
    
    .ctrl{position:absolute;inset:0;display:flex;align-items:center;justify-content:space-between;padding:14px;pointer-events:none}
    .ctrl .btn{pointer-events:auto;width:40px;height:40px;border-radius:50%;border:1px solid rgba(0,0,0,.1);
      background:rgba(255,255,255,.85);cursor:pointer;display:flex;align-items:center;justify-content:center}
.slider{position:relative;overflow:hidden;aspect-ratio:16/9;margin:24px 0;border-radius:var(--radius);box-shadow:var(--shadow)}
    .slides{display:flex;width:100%;height:100%;transition:transform .5s ease}
    .slide{flex:0 0 100%;position:relative}
    .slide img{position:absolute;inset:0;width:100%;height:100%;object-fit:cover}
    .content{display:grid;gap:26px;margin:20px 0 60px;}
    .info{background:var(--card);padding:20px;border-radius:var(--radius);box-shadow:var(--shadow)}
    .price{color:var(--accent);font-size:22px;font-weight:600}
    .meta{color:var(--muted);margin-bottom:14px}
    .map{border-radius:var(--radius);overflow:hidden;box-shadow:var(--shadow)}
    footer{margin:40px 0;color:var(--muted);font-size:14px;text-align:center}
  </style>
</head>
<body>
<header>
  <div class="container">
    <nav>
      <a href="index.html" class="brand"><div class="logo"></div><span>Agence Immo</span></a>
      <div class="menu">
        <a href="catalogue.html">Projets</a>
        <a href="contact.html">Contact</a>
      </div>
    </nav>
  </div>
</header>

<main class="container">
  <section class="slider" id="gallery">
    <div class="slides"></div>
    <div class="ctrl"><button class="btn prev">◀</button><button class="btn next">▶</button></div>
  </section>

  <section class="content">
    <article class="info">
      <h2 id="detailTitle">Détails du bien</h2>
      <p class="price" id="detailPrice"></p>
      <p class="meta" id="detailMeta"></p>
      <p id="detailDesc"></p>
    </article>
    <article class="map">
      <iframe id="detailMap" loading="lazy"></iframe>
    </article>
  </section>

  <div style="text-align:center; margin:30px 0;">
    <a id="editBtn" class="btn" style="padding:12px 20px; background:#0f3d6e; color:#fff; border-radius:10px; text-decoration:none; font-weight:600;">
      ✏️ Modifier ce projet
    </a>
  </div>
</main>

<footer><p>© Agence Immo — 2025 · Tous droits réservés.</p></footer>

<script>
function qs(id){return document.getElementById(id);}
function getParams(){ const p=new URLSearchParams(location.search); const o={}; for(const [k,v] of p) o[k]=v; return o; }
function buildGallery(images){
  const slides = document.querySelector('#gallery .slides');
  if(!slides) return;
  slides.innerHTML = '';
  const arr = Array.isArray(images) ? images : [images];
  arr.forEach(src=>{
    if(!src) return;
    const slide = document.createElement('div');
    slide.className = 'slide';
    const im = document.createElement('img');
    im.src = src; im.alt = 'Photo du bien';
    slide.appendChild(im);
    slides.appendChild(slide);
  });
}
document.addEventListener('DOMContentLoaded', ()=>{
  const params = getParams();
  if(!params.id){ return; }
  try{
    const arr = JSON.parse(localStorage.getItem('projets')||'[]');
    const p = arr.find(x=>x.id===params.id);
    if(!p) return;
    qs('detailTitle').textContent = p.titre || 'Détails du bien';
    qs('detailPrice').textContent = p.prix ? (Number(p.prix)).toLocaleString('fr-FR') + ' €' : '';
    qs('detailMeta').textContent = `${p.ville||''} (${p.departement||''}) – ${p.surfaceBien||''} m² hab. / ${p.surfaceTerrain||''} m² terrain – ${p.dispo||''}`;
    qs('detailDesc').textContent = p.desc || '';
    buildGallery(p.images);
    const editBtn = document.getElementById('editBtn');
    if(editBtn){ editBtn.href = 'ajout-projet.html?id=' + encodeURIComponent(params.id); }
  }catch(e){ console.error(e); }

    let currentIndex=0;
    const slides = document.querySelectorAll('#gallery .slide');
    const prev=document.querySelector('.ctrl .prev');
    const next=document.querySelector('.ctrl .next');
    function showSlide(i){
      if(!slides.length) return;
      currentIndex=(i+slides.length)%slides.length;
      document.querySelector('#gallery .slides').style.transform='translateX(' + (-currentIndex*100) + '%)';
    }
    if(prev&&next){
      prev.addEventListener('click', ()=>showSlide(currentIndex-1));
      next.addEventListener('click', ()=>showSlide(currentIndex+1));
    }

});
</script>
</body>
</html>
